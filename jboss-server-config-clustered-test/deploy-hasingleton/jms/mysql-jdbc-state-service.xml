<?xml version="1.0" encoding="UTF-8"?>

<!-- $Id: hsqldb-jdbc-state-service.xml 63362 2007-06-05 19:19:17Z adrian@jboss.org $ -->

<server>

  <!-- ==================================================================== -->
  <!-- JBossMQ State Management                                             -->
  <!--                                                                      -->
  <!-- This configuration uses DefaultDS which by default is HSQLDB         -->
  <!--                                                                      -->
  <!-- If you want to use a different database/jndi name then either change -->
  <!-- the ConnectionManager property, e.g.                                 -->
  <!-- Oracle: jboss.jca:service=DataSourceBinding,name=OracleDS            -->
  <!-- or                                                                   -->
  <!-- change the jndi binding DefaultDS to be the database you want to use.-->
  <!-- ==================================================================== -->
   
  <!-- A Statemanager that stores state in the database -->
  <mbean code="org.jboss.mq.sm.jdbc.JDBCStateManager"
	      name="jboss.mq:service=StateManager">
    <depends optional-attribute-name="ConnectionManager">jboss.jca:service=DataSourceBinding,name=jdbc/campaignAdminDS</depends>
    <attribute name="SqlProperties">
      CREATE_TABLES_ON_STARTUP = TRUE
      CREATE_USER_TABLE = CREATE TABLE JMS_USERS (USERID VARCHAR(32) NOT NULL, PASSWD VARCHAR(32) NOT NULL, \
                                                 CLIENTID VARCHAR(128) NULL, PRIMARY KEY(USERID))
      CREATE_ROLE_TABLE = CREATE TABLE JMS_ROLES (ROLEID VARCHAR(32) NOT NULL, USERID VARCHAR(32) NOT NULL, \
                                                 PRIMARY KEY(USERID, ROLEID))
      CREATE_SUBSCRIPTION_TABLE = CREATE TABLE JMS_SUBSCRIPTIONS (CLIENTID VARCHAR(128) NOT NULL, \
                                                 SUBNAME VARCHAR(128) NOT NULL, TOPIC VARCHAR(255) NOT NULL, \
                                                 SELECTOR VARCHAR(255) NULL, PRIMARY KEY(CLIENTID, SUBNAME))
      GET_SUBSCRIPTION = SELECT topic, selector FROM jms_subscriptions WHERE clientid=? AND subname=?
      LOCK_SUBSCRIPTION = SELECT topic, selector FROM jms_subscriptions WHERE clientid=? AND subname=?
      GET_SUBSCRIPTIONS_FOR_TOPIC = SELECT clientid, subname, selector FROM jms_subscriptions WHERE topic=?
      INSERT_SUBSCRIPTION = INSERT INTO jms_subscriptions (clientid, subname, topic, selector) VALUES(?,?,?,?)
      UPDATE_SUBSCRIPTION = UPDATE jms_subscriptions SET topic=?, selector=? WHERE clientid=? AND subname=?
      REMOVE_SUBSCRIPTION = DELETE FROM jms_subscriptions WHERE clientid=? AND subname=?
      GET_USER_BY_CLIENTID = SELECT userid, passwd, clientid FROM jms_users WHERE clientid=?
      GET_USER = SELECT passwd, clientid FROM jms_users WHERE userid=?
    </attribute>
  </mbean>

</server>
