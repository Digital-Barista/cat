<?xml version="1.0" encoding="utf-8"?>
<Node xmlns="com.dbi.cat.view.workspace.*" 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	xmlns:components="com.dbi.cat.view.components.*"
	implements="com.dbi.cat.view.workspace.ILayoutInfoItem"
	width="400" height="300" xmlns:vo="com.dbi.cat.vo.*"
	editWindowHeight="350"
	editWindowWidth="350"
	displayIcon="{couponIcon}"
	workspaceIcon="{couponIcon}"
	x="{nodeVO.layoutInfo.x}"
	y="{nodeVO.layoutInfo.y}"
	label="Coupon"
	creationComplete="init()">
	<mx:Script>
		<![CDATA[
			import com.dbi.cat.common.vo.CouponVO;
			import com.dbi.cat.common.constants.SMSConstants;
			import mx.events.ChildExistenceChangedEvent;
			import com.dbi.cat.common.vo.ClientVO;
			import com.dbi.cat.common.vo.CampaignVO;
			import com.dbi.cat.common.vo.MessageVO;
			import com.dbi.cat.common.vo.LayoutInfoVO;
			
			
			[Bindable(event="nodeUpdate")]
			public function get couponVO():CouponVO
			{
				return editNodeVO as CouponVO;
			}
			public function set couponVO(c:CouponVO):void
			{
				nodeVO = c;
			}
			public function get layoutInfo():LayoutInfoVO
			{
				return couponVO.layoutInfo;
			}
			public function set layoutInfo(info:LayoutInfoVO):void
			{
				couponVO.layoutInfo = info;
			}
			public function get voUID():String
			{
				return couponVO.uid;
			}
			
			override public function get valid():Boolean
			{
				return couponVO != null && couponVO.valid;
			}
			
			
			private function updateAvailableMessage():void
			{
				if (AvailableMessage.text.length <= SMSConstants.MAX_CHARACTERS)
					couponVO.availableMessage = AvailableMessage.text;
				else
				{
					couponVO.availableMessage = couponVO.availableMessage.substring(0, SMSConstants.MAX_CHARACTERS);
					AvailableMessage.text = couponVO.availableMessage;
				}
			}
			
			private function init():void
			{
			}
			
			private function setInfiniteRedemptions():void
			{
				if (Infinite.selected)
					couponVO.maxRedemptions = CouponVO.INFINITE_REDEMPTION_COUNT;
				else
					couponVO.maxRedemptions = 0;
			}
			
		]]>
	</mx:Script>
	<editContent>
		<mx:Form right="0" left="0" top="0" bottom="0" 
			paddingLeft="5" paddingRight="5" paddingBottom="5" paddingTop="5">
			<mx:FormItem label="Title" width="100%">
				<mx:TextInput id="Title" width="200"
					text="{couponVO.name}"
					change="{couponVO.name = Title.text}" />
			</mx:FormItem>
			<mx:FormItem label="Max Redemptions">
				<mx:HBox width="100%">
					<mx:TextInput id="MaxRedemptions" width="80"
						restrict="[0-9]"
						text="{couponVO.maxRedemptions}"
						change="{couponVO.maxRedemptions = new Number(MaxRedemptions.text)}"
						visible="{couponVO.maxRedemptions != CouponVO.INFINITE_REDEMPTION_COUNT}"
						includeInLayout="{couponVO.maxRedemptions != CouponVO.INFINITE_REDEMPTION_COUNT}" />
					<mx:CheckBox id="Infinite"
						label="Infinite"
						selected="{couponVO.maxRedemptions == CouponVO.INFINITE_REDEMPTION_COUNT}"
						change="{setInfiniteRedemptions()}" />
				</mx:HBox>
			</mx:FormItem>
			<mx:FormItem label="Unavailable Date">
				<mx:DateField id="UnavailableDate"
					selectedDate="{couponVO.unavailableDate}"
					change="{couponVO.unavailableDate = UnavailableDate.selectedDate}" />
			</mx:FormItem>
			<mx:FormItem label="Available" required="true" width="100%" >
					<mx:TextArea id="AvailableMessage"  width="200" height="70"
						maxChars="{SMSConstants.MAX_CHARACTERS}"
						text="{couponVO.availableMessage}" 
						change="updateAvailableMessage()"/>
			</mx:FormItem>
			<mx:FormItem>
				<mx:Label text="{couponVO.availableMessage.length + '/' + SMSConstants.MAX_CHARACTERS + ' chars'}" />
			</mx:FormItem>
			<mx:FormItem label="Unavailable" >
				<mx:TextArea id="UnavailableMessage" width="200" height="70"
					text="{couponVO.unavailableMessage}"
					change="{couponVO.unavailableMessage = UnavailableMessage.text}"
					maxChars="{SMSConstants.MAX_CHARACTERS}"  />
			</mx:FormItem>
			<mx:FormItem>
				<mx:Label text="{couponVO.unavailableMessage.length + '/' + SMSConstants.MAX_CHARACTERS + ' chars'}" />
			</mx:FormItem>
		</mx:Form>
	</editContent>
</Node>
