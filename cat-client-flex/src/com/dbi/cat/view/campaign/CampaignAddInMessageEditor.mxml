<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
	width="100%" height="100%"
	label="{entryType}">
	<mx:Script>
		<![CDATA[
			import com.dbi.cat.common.vo.CampaignVO;
			import mx.collections.ArrayCollection;
			import com.dbi.cat.common.vo.ClientVO;
			import com.dbi.cat.common.vo.AddInMessageVO;
			import com.dbi.cat.common.constants.AddInMessageType;
			
			private var _currentCampaign:CampaignVO;
			[Bindable]
			public function get currentCampaign():CampaignVO
			{
				return _currentCampaign;
			}
			public function set currentCampaign(c:CampaignVO):void
			{
				_currentCampaign = c;
				dispatchEvent(new Event("dataUpdate"));	
			}
			
			private var _entryType:String;
			[Bindable]
			public function get entryType():String
			{
				return _entryType;
			}
			public function set entryType(value:String):void
			{
				_entryType = value;
				dispatchEvent(new Event("dataUpdate"));	
			}
			
			
			[Bindable(event="dataUpdate")]
			private function get addInMessage():AddInMessageVO
			{
				if (currentCampaign != null &&
					currentCampaign.addInMessages != null &&
					entryType != null)
				{
					for each (var add:AddInMessageVO in currentCampaign.addInMessages)
					{
						if (add.entryType == entryType &&
							add.type == AddInMessageType.CLIENT)
							return add;
					}
				}
				return null;
			}
			
			private function changeAddInMessage():void
			{
				if (addInMessage != null)
				{
					addInMessage.message = AddIn.text;
				}
				else
				{
					var add:AddInMessageVO = new AddInMessageVO();
					add.campaignId = currentCampaign.primaryKey.toString();
					add.entryType = entryType;
					add.type = AddInMessageType.CLIENT;
					add.message = AddIn.text;
					
					if (currentCampaign.addInMessages == null)
						currentCampaign.addInMessages = new ArrayCollection();
					currentCampaign.addInMessages.addItem(add);
				}
			}
		]]>
	</mx:Script>
	<mx:TextArea id="AddIn"
		borderStyle="none"
		width="100%"
		change="changeAddInMessage()"
		text="{addInMessage.message}" />
</mx:Canvas>
